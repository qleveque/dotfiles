# vim: set ft=bash:
color search-result default blue
set log-options = --quiet --follow
set show-changes = no
set ignore-case = smart-case
set blame-view = author:abbreviated date:custom,format=%d/%m/%Y line-number:yes,interval=1 text
set split-view-width = 99%
set vertical-split = vertical

bind generic g none
bind generic gg :0
bind generic G move-last-line
bind generic y none
bind generic yc !@>zsh -fc "echo -n %(commit) | c"
bind generic yf !@>zsh -fc "echo -n %(file) | c"
bind generic ; back
bind generic <C-q> :quit
bind diff + :/\|\s+(0|[0-9]+\s[\+-]+)$
bind diff - :?\|\s+(0|[0-9]+\s[\+-]+)$
bind status + :/^\S+
bind status - :?^\S+
bind generic l enter

bind log l !@>tmux new-window -a "tig show '%(commit)'"
bind diff l !@>tmux new-window -a "\
  export FILE=\"$(readlink -f '%(file)')\";\
  PARAMS=('%(commit)^!');\
  [[ -n '%(stash)' ]] && PARAMS=('%(stash)^' '%(stash)');\
  git difftool --trust-exit-code --no-prompt ${(@)PARAMS} -- '%(file)';\
"
bind stage l !@>tmux new-window -a "\
  export FILE=\"$(readlink -f '%(file)')\";\
  PARAMS=();\
  [[ '%(status)' =~ 'Staged changes' ]] && PARAMS+=('--staged');\
  git difftool --trust-exit-code --no-prompt ${(@)PARAMS} -- '%(file)';\
"
bind status l !@>tmux new-window -a "\
  if [[ '%(status)' =~ 'Untracked file' ]]; then\
    nvim '%(file)';\
  else;\
    export FILE=\"$(readlink -f '%(file)')\";\
    PARAMS=();\
    [[ '%(status)' =~ 'Staged changes' ]] && PARAMS+=('--staged');\
    git difftool --trust-exit-code --no-prompt ${(@)PARAMS} -- '%(file)';\
  fi;\
"
